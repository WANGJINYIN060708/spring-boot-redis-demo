(function($){$.util.namespace("$.fn.tree.extensions");$.fn.tree.extensions.dataPlainConverter=function(data,opts){data=data||[];var ret=data,idField=opts.idField||"id",parentField=opts.parentField||"pid";if(opts.dataPlain){var roots=$.array.filter(data,function(val){if(val[parentField]==null||val[parentField]==undefined){return true}return!$.array.some(data,function(value){return val[parentField]==value[idField]})});var findChildren=function(array,value){var temps=$.array.filter(array,function(val){return val[parentField]==null||val[parentField]==undefined?false:val[parentField]==value[idField]});return $.array.map(temps,function(val){var children=findChildren(array,val);if(children.length){val.children=$.array.likeArray(val.children)&&!$.util.isString(val.children)?val.children:[];$.array.merge(val.children,children)}return val})};ret=$.array.map(roots,function(val){var children=findChildren(data,val);if(children.length){val.children=$.array.likeArray(val.children)&&!$.util.isString(val.children)?val.children:[];$.array.merge(val.children,children)}return val})}return ret};var _loadFilter=$.fn.tree.extensions._loadFilter=$.fn.tree.defaults.loadFilter;var loadFilter=$.fn.tree.extensions.loadFilter=function(data,parent){if($.isFunction($.fn.tree.extensions._loadFilter)){data=$.fn.tree.extensions._loadFilter.apply(this,arguments)}data=$.array.likeArray(data)&&!$.util.isString(data)?data:[];if(!data.length){return data}var t=$(this),opts=t.tree("options");return opts.dataPlain?$.fn.tree.extensions.dataPlainConverter(data,opts):data};function remoteLoad(target,param){var t=$(target);if(!param){return t.tree("reload")}if(typeof param=="string"){t.tree("options").url=param;return remoteLoad(target,{})}var opts=t.tree("options"),queryParams=opts.queryParams;opts.queryParams=$.extend({},queryParams,param);t.tree("reload")}var defaults=$.fn.tree.extensions.defaults={dataPlain:false,parentField:"parentId",loadFilter:loadFilter};var methods=$.fn.tree.extensions.methods={load:function(jq,param){return jq.each(function(){remoteLoad(this,param)})}};$.extend($.fn.tree.defaults,defaults);$.extend($.fn.tree.methods,methods)})(jQuery);
