(function($){$.util.namespace("$.fn.panel.extensions");$.util.namespace("$.fn.window.extensions");$.util.namespace("$.fn.dialog.extensions");$.extend($.fn.panel.extensions,{onBeforeDestroy:$.fn.panel.defaults.onBeforeDestroy});$.extend($.fn.window.extensions,{onBeforeDestroy:$.fn.window.defaults.onBeforeDestroy});$.extend($.fn.dialog.extensions,{onBeforeDestroy:$.fn.dialog.defaults.onBeforeDestroy});function onBeforeDestroy(){$("iframe,frame",this).each(function(){try{if(this.contentWindow&&this.contentWindow.document&&this.contentWindow.close){this.contentWindow.document.write("");this.contentWindow.close()}if(window.CollectGarbage){window.CollectGarbage()}}catch(ex){}}).remove()}$.fn.panel.defaults.onBeforeDestroy=onBeforeDestroy;$.fn.window.defaults.onBeforeDestroy=onBeforeDestroy;$.fn.dialog.defaults.onBeforeDestroy=onBeforeDestroy;function getIframe(target){var t=$(target),body=t.panel("body");return body.children("iframe.panel-iframe")}function setExtensionsOptions(opts){opts._ext_panel_originals={href:opts.href,content:opts.content};if(opts.iniframe){opts.href=null;opts.content=null}}function initializeExtensions(target){var t=$(target),state=$.data(target,"panel"),opts=state.options,originals=opts._ext_panel_originals?opts._ext_panel_originals:opts._ext_panel_originals={href:opts.href,content:opts.content};opts.href=originals.href;opts.content=originals.content;if(opts.iniframe){refresh(target)}if(opts.inline){var panel=t.panel("panel"),parent=panel.parent();if(!parent.is("body")&&!$.array.contains(["fixed","absolute","relative"],parent.css("position"))){parent.addClass("panel-container")}}}function loadPanel(target){var state=$.data(target,"panel");if(!state.isLoaded||!opts.cache){var t=$(target),opts=state.options,param=$.extend({},opts.queryParams);if(opts.onBeforeLoad.call(target,param)==false){return}state.isLoaded=false;t.panel("clear");if(opts.loadingMessage){t.html($('<div class="panel-loading"></div>').html(opts.loadingMessage))}opts.loader.call(target,param,success,error);function success(data){var html=opts.extractor.call(target,data);$(target).html(html);$.parser.parse($(target));opts.onLoad.apply(target,arguments);state.isLoaded=true}function error(){opts.onLoadError.apply(target,arguments)}}}function loadPanelIframe(target){var t=$(target),state=$.data(target,"panel"),opts=state.options,param=$.extend({},opts.queryParams);if(opts.onBeforeLoad.call(target,param)==false){return}var content="<iframe class='panel-iframe' frameborder='0' width='100%' height='100%' marginwidth='0px' marginheight='0px' scrolling='auto'></iframe>";t.panel("clear");t.addClass("panel-body-withframe").html(content);t.panel("iframe").bind({load:function(){if($.isFunction(opts.onLoad)){opts.onLoad.apply(target,arguments)}},error:function(){if($.isFunction(opts.onLoadError)){opts.onLoadError.apply(target,arguments)}}}).attr("src",opts.href||"");state.isLoaded=true}function refresh(target,href){var t=$(target),state=$.data(target,"panel"),opts=state.options;state.isLoaded=false;if(href){if(typeof href=="string"){opts.href=href}else{opts.queryParams=href}}if(!opts.href){return}t.panel("body").removeClass("panel-body-withframe");if(opts.iniframe){loadPanelIframe(target)}else{loadPanel(target)}}var _panel=$.fn.panel;$.fn.panel=function(options,param){if(typeof options=="string"){return _panel.apply(this,arguments)}options=options||{};return this.each(function(){var jq=$(this),isInited=$.data(this,"panel")?true:false,opts=isInited?options:$.extend({},$.fn.panel.parseOptions(this),$.parser.parseOptions(this,[{iniframe:"boolean"}]),options);if(!isInited){setExtensionsOptions(opts)}_panel.call(jq,opts,param);if(!isInited){initializeExtensions(this)}})};$.union($.fn.panel,_panel);var defaults=$.fn.panel.extensions.defaults={iniframe:false,onBeforeDestroy:onBeforeDestroy};var methods=$.fn.panel.extensions.methods={iframe:function(jq){return getIframe(jq[0])},refresh:function(jq,href){return jq.each(function(){refresh(this,href)})}};$.extend($.fn.panel.defaults,defaults);$.extend($.fn.panel.methods,methods)})(jQuery);
